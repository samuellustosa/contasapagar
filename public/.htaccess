RewriteEngine On
RewriteBase /

# 1. Forçar o uso de HTTPS (Essencial para PWA)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 2. Bloquear acesso direto a pastas sensíveis (Segurança)
RewriteRule ^(app|vendor|Core) - [F,L]

# 3. EXCEÇÃO PARA ARQUIVOS REAIS (PWA e Assets)
# Se o arquivo ou diretório existe fisicamente, entrega ele diretamente.
# Isso impede que o index.php tente processar o sw.js ou manifest.json.
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 4. Gerenciamento de Rotas Amigáveis
# Tudo o que não for um arquivo real cai aqui.
# Usamos uma condição para garantir que não estamos reescrevendo arquivos legítimos.
RewriteCond %{REQUEST_URI} !index\.php
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]